<html>
<head>
    <title>Sorryios AI Launcher</title>
    <HTA:APPLICATION
        ID="SorryiosLauncher"
        APPLICATIONNAME="Sorryios AI"
        BORDER="thin"
        BORDERSTYLE="normal"
        CAPTION="yes"
        MAXIMIZEBUTTON="no"
        MINIMIZEBUTTON="yes"
        SHOWINTASKBAR="yes"
        SINGLEINSTANCE="yes"
        SYSMENU="yes"
        VERSION="1.0"
        WINDOWSTATE="normal"
    />
    <style>
        body {
            font-family: Segoe UI, Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            margin: 0;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin: 0 0 5px 0;
            font-size: 20px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 12px;
        }
        .status-box {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .status-row {
            margin: 8px 0;
        }
        .status-label {
            display: inline-block;
            width: 150px;
        }
        .stopped { color: #d32f2f; font-weight: bold; }
        .running { color: #388e3c; font-weight: bold; }
        .btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }
        .btn-start { background: #4CAF50; color: white; }
        .btn-stop { background: #f44336; color: white; }
        .btn-open { background: #2196F3; color: white; }
        .btn-gray { background: #e0e0e0; color: #333; }
        .btn:hover { opacity: 0.9; }
        .log-box {
            background: #1a1a2e;
            color: #4CAF50;
            border-radius: 6px;
            padding: 10px;
            font-family: Consolas, monospace;
            font-size: 11px;
            height: 80px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .row { margin-bottom: 5px; }
        .half { width: 48%; display: inline-block; }
    </style>
    <script language="VBScript">
        Dim shell, fso, projectDir
        
        Sub Window_OnLoad()
            window.resizeTo 420, 480
            window.moveTo (screen.width - 420) / 2, (screen.height - 480) / 2
            
            Set shell = CreateObject("WScript.Shell")
            Set fso = CreateObject("Scripting.FileSystemObject")
            
            projectDir = fso.GetParentFolderName(document.location.pathname)
            If Left(projectDir, 1) = "\" Then
                projectDir = Mid(projectDir, 2)
            End If
            
            Log "Ready. Project: " & projectDir
            CheckStatus()
        End Sub
        
        Sub Log(msg)
            Dim logBox
            Set logBox = document.getElementById("logBox")
            logBox.innerHTML = logBox.innerHTML & "> " & msg & "<br>"
            logBox.scrollTop = logBox.scrollHeight
        End Sub
        
        Sub CheckStatus()
            On Error Resume Next
            Dim result
            
            result = shell.Run("cmd /c netstat -ano | findstr :3000 | findstr LISTENING > nul", 0, True)
            If result = 0 Then
                document.getElementById("backendStatus").className = "running"
                document.getElementById("backendStatus").innerText = "RUNNING"
            Else
                document.getElementById("backendStatus").className = "stopped"
                document.getElementById("backendStatus").innerText = "STOPPED"
            End If
            
            result = shell.Run("cmd /c netstat -ano | findstr :5173 | findstr LISTENING > nul", 0, True)
            If result = 0 Then
                document.getElementById("frontendStatus").className = "running"
                document.getElementById("frontendStatus").innerText = "RUNNING"
            Else
                document.getElementById("frontendStatus").className = "stopped"
                document.getElementById("frontendStatus").innerText = "STOPPED"
            End If
        End Sub
        
        Sub StartServices()
            Log "Starting services..."
            
            Log "Starting backend (port 3000)..."
            shell.Run "cmd /k cd /d """ & projectDir & "\backend"" && title Sorryios-Backend && npm run dev", 1, False
            
            Log "Starting frontend (port 5173)..."
            shell.Run "cmd /k cd /d """ & projectDir & "\frontend"" && title Sorryios-Frontend && npm run dev", 1, False
            
            Log "Waiting for services to start..."
            window.setTimeout "CheckStatus()", 6000
            window.setTimeout "OpenPages()", 8000
        End Sub
        
        Sub OpenPages()
            CheckStatus()
            Log "Opening browser pages..."
            shell.Run "http://localhost:5173", 1, False
            shell.Run "http://localhost:3000", 1, False
            Log "Done! Pages opened."
        End Sub
        
        Sub StopServices()
            Log "Stopping services..."
            
            shell.Run "cmd /c for /f ""tokens=5"" %a in ('netstat -ano ^| findstr :3000 ^| findstr LISTENING') do taskkill /PID %a /F", 0, True
            shell.Run "cmd /c for /f ""tokens=5"" %a in ('netstat -ano ^| findstr :5173 ^| findstr LISTENING') do taskkill /PID %a /F", 0, True
            shell.Run "cmd /c taskkill /FI ""WINDOWTITLE eq Sorryios-Backend*"" /F", 0, True
            shell.Run "cmd /c taskkill /FI ""WINDOWTITLE eq Sorryios-Frontend*"" /F", 0, True
            
            Log "Services stopped!"
            window.setTimeout "CheckStatus()", 1000
        End Sub
        
        Sub OpenBrowser()
            shell.Run "http://localhost:5173", 1, False
        End Sub
        
        Sub OpenBackend()
            shell.Run "http://localhost:3000", 1, False
        End Sub
        
        Sub InstallDeps()
            Log "Installing dependencies..."
            shell.Run "cmd /k cd /d """ & projectDir & """ && cd backend && npm install && cd ..\frontend && npm install && echo. && echo Done! && pause", 1, False
        End Sub
    </script>
</head>
<body>
    <div class="container">
        <h1>Sorryios AI Launcher</h1>
        <p class="subtitle">Smart Note System</p>
        
        <div class="status-box">
            <div class="status-row">
                <span class="status-label">Backend (3000):</span>
                <span id="backendStatus" class="stopped">checking...</span>
            </div>
            <div class="status-row">
                <span class="status-label">Frontend (5173):</span>
                <span id="frontendStatus" class="stopped">checking...</span>
            </div>
        </div>
        
        <div class="row">
            <button class="btn btn-start half" onclick="StartServices()">Start</button>
            <button class="btn btn-stop half" onclick="StopServices()">Stop</button>
        </div>
        
        <button class="btn btn-open" onclick="OpenBrowser()">Open Browser (localhost:5173)</button>
        
        <div class="row">
            <button class="btn btn-gray half" onclick="CheckStatus()">Refresh</button>
            <button class="btn btn-gray half" onclick="InstallDeps()">Install Deps</button>
        </div>
        
        <div class="log-box" id="logBox"></div>
    </div>
</body>
</html>
